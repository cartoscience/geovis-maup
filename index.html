<!DOCTYPE html>
<html>
  
  // <!-- Thanks to the following creators -->	
  // <!-- https://github.com/Leaflet/Leaflet -->
  // <!-- https://github.com/JackDougherty/leaflet-map-simple -->
  // <!-- https://github.com/simonwhitaker/github-fork-ribbon-css --> 
  // <!-- https://github.com/gka/chroma.js -->	
  // <!-- https://github.com/d3/d3 -->	
  // <!-- https://github.com/geotiffjs/geotiff.js -->
  // <!-- https://github.com/IHCantabria/Leaflet.CanvasLayer.Field -->
  // <!-- https://github.com/leaflet-extras/leaflet-providers --> 
	
<head>
  <title>productivity-trends</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta charset="utf-8">
	
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.2.2/gh-fork-ribbon.min.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.4/dist/leaflet.css"
  integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA=="
  crossorigin=""/>
  
  <script src="https://unpkg.com/leaflet@1.3.4/dist/leaflet.js"
  integrity="sha512-nMMmRyTVoLYqjP9hrbed9S+FzjZHW5gY1TWCHA5ckwXZBadntCNs8kEqAWdrb9O7rxbCaA4lKTIWjDXZxflOcA=="
  crossorigin=""></script>
  
  <script src="//cdnjs.cloudflare.com/ajax/libs/chroma-js/1.3.4/chroma.min.js"></script>
  <script src="//d3js.org/d3.v4.min.js"></script>
  <script src="//npmcdn.com/geotiff@0.3.6/dist/geotiff.js"></script>
  <script src="https://ihcantabria.github.io/Leaflet.CanvasLayer.Field/dist/leaflet.canvaslayer.field.js"></script>
	
  <style>
  body { margin:0; padding:0; }
  #map { position: absolute; top:0; bottom:0; right:0; left:0; }
	  
  .github-fork-ribbon.right-top:before {
            background-color: #454545; 
  }
  .github-fork-ribbon.right-top:after {
            color: #dbdbdb; 
	    border-width: 0; 
	    text-shadow: 0 -.00em rgba(0, 0, 0, 0.5);
  }
	  
  </style>
	
</head>
	
<body>
  <div id="map"></div>
  <div id="controlBox"></div>
  <a class="github-fork-ribbon right-top" href="https://cartoscience.com" data-ribbon="cartoscience.com" title="cartoscience.com">cartoscience.com</a>
  <script>
  
  var map = L.map('map', {
      scrollWheelZoom: true
  });
  
  var controlLayers = L.control.layers( null, null, {
  	position: "topleft"
  }).addTo(map);
	  
  var esri = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
	attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community',
  	minZoom: 2,
	maxZoom: 12
  }).addTo(map);
	  
  var colors = ['#f1c468', '#e2783e', '#8ccbce', '#296597', '#a1c453', '#4e8f42'];
      
  d3.text('./images/mwc_ea_pt_4326.asc', function (asc) {
  	var s = L.ScalarField.fromASCIIGrid(asc);
    	var layerone = L.canvasLayer.scalarField(s).addTo(map);
	layerone.setColor(chroma.scale(colors).classes(2,5);
	controlLayers.addOverlay(layerone, 'Country level trends');
    	map.fitBounds(layerone.getBounds());
	  
    	layerone.on('click', function (e) {
	    if (e.value !== null) {
		    var v = e.value; //.toFixed(1);
		    var html = `<span class="popupText">Category: ${v} </span>`;
		    var popup = L.popup().setLatLng(e.latlng).setContent(html).openOn(map);
	    }
    	});	  
  });
	  
  map.createPane('labels');
  map.getPane('labels').style.zIndex = 650;
  map.getPane('labels').style.pointerEvents = 'none';
  var Stamen_TonerHybrid = L.tileLayer('https://stamen-tiles-{s}.a.ssl.fastly.net/toner-hybrid/{z}/{x}/{y}{r}.{ext}', {
	attribution: 'Boundary tiles by <a href="http://stamen.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>; Map design by Brad G. Peter, &copy <a href="https://cartoscience.com/multiscalar-decision-support">CartoScience</a>, <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> &mdash; Map and manuscript published by &copy <a href="https://www.tandfonline.com/doi/abs/10.1080/24694452.2017.1403877">AAG</a>.',
	subdomains: 'abcd',
	minZoom: 0,
	maxZoom: 20,
	ext: 'png',
	pane: 'labels'
  }).addTo(map);
	  
  </script>
	
</body>
	
</html>
